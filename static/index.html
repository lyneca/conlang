<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dalgarian Translator</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
    <script>
        function toggle() {
            let input = document.getElementById('input');
            let preview = document.getElementById('preview');
            if (input.classList.contains("hidden")) {
                input.classList.remove("hidden");
                preview.classList.remove("hidden");
            } else {
                input.classList.add("hidden");
                preview.classList.add("hidden");
            }

        }
        function random() {
            fetch("/random").then(data => data.json()).then(data => {
                let elem = document.getElementById('input');
                elem.value = data.data;
                update(elem);
            });
        }
        function process(text) {
            return (" " + text.toLowerCase() + " ")
                .replace(/x/g, 'ks')
                .replace(/sh/g, 'x')
                .replace(/ph/g, 'f')
                .replace(/cc/g, 'ks')
                .replace(/ck/g, 'k')
                .replace(/([^aeiou])\1/g, value => value[0])
                .replace(/c[aou]/g, value => 'k' + value[1])
                .replace(/c[^aeiouh]/g, value => 'k' + value[1])
                .replace(/ c[aeiou]/g, value => ' k' + value[2])
                .replace(/t?ch/g, 'c')
                .replace(/[kw]h/g, value => value[0])
                .replace(/gh[., t]/g, value => value[2])
                .replace(/gh/g, 'g')
                .replace(/gn/g, 'n')
                .replace(/-/g, '')
                .replace(/[^\\]'/g, value => value[0])
                .replace(/[,. ] /g, value => value[0])
                .replace(/ook/g, 'u"k')
                .replace(/ooth/g, 'u"th')
                .replace(/ere[ .,]/g, value => 'e"r ' + value[3])
                .replace(/[u]ge[ .,]/g, value => value[0] + '"j' + value[3])
                .replace(/[aeio]ge[ .,]/g, value => value[0] + 'j' + value[3])
                .replace(/pp/, 'p')
                .replace(/ou[ntrd]/g, value => 'ow' + value[2])
                .replace(/ou/g, 'o"')
                .replace(/two/g, 'tu"')
                .replace(/a[sndtzlv]e[ .,]/g, value => `ay${value[1]} `)
                .replace(/e[sndtzlv]e[ .,]/g, value => `e"${value[1]} `)
                .replace(/i[sndtzlv]e[ .,]/g, value => `i"${value[1]} `)
                .replace(/o[sndtzlv]e[ .,]/g, value => `ow${value[1]} `)
                .replace(/u[sndtzlv]e[ .,]/g, value => `u"${value[1]} `)
                .replace(/r[sndtzlv]e[ .,]/g, value => `r${value[1]} `)
                .replace(/[lrpdf]i[aeo]n[ .,]/g, value => `${value[0]}e"${value[2]}n${value[4]} `)
                .replace(/ti[aeo]n[ .,]/g, value => `x\`n${value[4]} `)
                .replace(/i[aeo]n[ .,]/g, value => `\`n${value[3]} `)
                .replace(/kes[ ,.]/g, value => 'ks' + value[3])
                .replace(/ked[ ,.]/g, value => 'kd' + value[3])
                .replace(/[^ ]one[ ,.]/g, value => value[0] + 'own ')
                .replace(/ved[ ,.]/g, value => 'vd' + value[3])
                .replace(/are[ ,.]/g, value => 'a"' + value[3])
                .replace(/qu/g, 'kw')
                .replace(/ui/g, value => 'u"')
                .replace(/ai/g, value => 'ay')
                .replace(/"ce[ ,.]/g, value => '"s ' + value[3])
                .replace(/[rl]ce[ ,.]/g, value => value[0] + 's' + value[3])
                .replace(/[aeiou]ce[ ,.]/g, value => value[0] + 'ys' + value[3])
                .replace(/ by[ ,.]/g, value => value[0] + ' bi"' + value[3])
                .replace(/[^aeiou ]y[ ,.]/g, value => value[0] + 'e"' + value[2])
                .replace(/[^aeiou ]y[^aeiou ]/g, value => value[0] + 'i"' + value[2])
                .replace(/the[ ,.]/g, value => 'q`' + value[3])
                .replace(/to[ ,.]/g, value => 'tu"' + value[2])
                .replace(/th/g, 'q')
                .replace(/ea/g, 'e"')
                .replace(/oi/g, 'oy')
                .replace(/a /g, '` ')
                .replace(/[ou]e/g, 'u"')
                .replace(/([aeiou`])\1"/g, value => value[0] + '"')
                .replace(/([aeiou`])\1/g, value => value[0] + '"')
                .replace(/([aeiou`])[ ,.]/g, value => value[0] + "' ")
                .replace(/[aeiou`][aeiou`]/g, value => value[0] + "'" + value[1])
                .trim();
        }

        function update(elem) {
            console.log(elem.value.split('\n'));
            let output = elem.value.split('\n').map(process).join("\n");;
            document.getElementById("output").innerText = output;
            document.getElementById("preview").innerText = output;
        }
    </script>
    <main>
        <h1>Translate English to Dalgarian</h1>
        <h2 class="dalg">translayt inglix tu" dalgare"an</h1>
        <button onclick="random()">Random Wiki Article</button>
        <button onclick="toggle()">Toggle English</button>
        <h4>Input Text</h4>
        <textarea type="text" name="input" id="input" onkeyup="update(this)"></textarea>
        <h4>Dalgarian Text</h4>
        <p class="dalg" id="output"></p>
        <h4>Internal representation</h4>
        <p id="preview"></p>
    </main>
    <script>
        update(document.getElementById('input'))
    </script>
</body>
</html>